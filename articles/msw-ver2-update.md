---
title: "MSW2.0ã«ãªã£ãŸçµŒç·¯ã‚’ãƒ–ãƒ­ã‚°ã‚’èª­ã‚“ã§è€ƒãˆã¦ã¿ãŸ"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

# ã¯ã˜ã‚ã«

MSW ã®ãƒ¡ã‚¤ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ 2.0 ã¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚’ã•ã‚Œã¾ã—ãŸã€‚
ã‹ãªã‚Šç ´å£Šçš„ãªå¤‰æ›´ã‚’ä¼´ã†æ›´æ–°ã§ã—ãŸãŒãƒ–ãƒ­ã‚°ã«çµŒç·¯ãŒæ›¸ã‹ã‚Œã¦ã„ãŸã®ã§ã€
ãã‚Œã‚’èª­ã¿è§£ããªãŒã‚‰ã€ä»Šå›ãªãœãã‚ŒãŒè¡Œã‚ã‚ŒãŸã‹ã¨ OSS ã‚’ä½¿ã†å´ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦ã®è¦–é‡ã‚’è€ƒãˆã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# MSW2.0 ã¨ã¯

ç°¡å˜ã«ã§ã™ãŒ MSW ã¨ã¯ä½•ã‹ã‚’æŒ¯ã‚Šè¿”ã£ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚
Mock Service Worker (MSW) ã¯ã€API ã®æŒ¯ã‚‹èˆã„ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
é–‹ç™ºä¸­ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã€å®Ÿéš›ã® API ã‚’å‘¼ã³å‡ºã™ã“ã¨ãªãã€ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»®ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã—è¨­å®šã™ã‚‹ã“ã¨ã§ã€API ã®å®Ÿè£…ã«ä¾å­˜ã™ã‚‹ã“ã¨ãªãé–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ç‰¹ã«ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨å¹³è¡Œã§é–‹ç™ºãŒé€²ã‚“ã§ã„ãŸå ´åˆã€ã¾ã  API ãŒå®Œæˆã—ã¦ãŠã‚‰ãšãƒ‡ãƒ¼ã‚¿ã‚‚è¿”ã£ã¦ã“ãªã„çŠ¶æ…‹ã§ã€
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ã¯æœ¬ç•ªã§ä½¿ç”¨ã™ã‚‹å½¢ã§ã® API ã‚’å‘¼ã³å‡ºã™é–¢æ•°ãªã©ã‚’å®Ÿè£…å‡ºæ¥ã‚‹ãŸã‚ã€ã‚ã–ã‚ã–ä»®ãªçŠ¶æ…‹ã‚’ä½œã‚‰ãšã¨ã‚‚ã„ã„ã¨ã„ã†åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

## ãªã«ãŒå¤‰ã‚ã£ãŸã®ã‹

ã§ã¯ä¸»ã«ã©ã†ã„ã†é¢¨ã«å¤‰ã‚ã£ãŸã®ã‹ã‚’ã€Migration ã®ãƒšãƒ¼ã‚¸ã‚’è¦‹ãªãŒã‚‰ç°¡å˜ã«ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
https://mswjs.io/docs/migrations/1.x-to-2.x

### ä»Šã¾ã§ã® API

ä»Šã¾ã§ã® MSW ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ä½œã‚Šæ–¹ã¯ã€å½¢ã«ã¯ã‚ˆã‚Šã¾ã™ãŒãƒ™ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```ts
import { rest } from 'msw';

const Handler = () => {
  return rest.get('/api/user', (req, res, ctx) => {
    return res(ctx.status(200), ctx.json({ message: 'Hello World' }));
  });
};
```

ã§ã¯ã“ã‚ŒãŒ 2.0 ã§ã©ã†å¤‰æ›´ã—ãŸã®ã‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ã“ã‚Œã‹ã‚‰ã® API

```ts
import { http } from "msw";

const Handler = () => {
  return http.get("/api/user", () => {
  return new Response('Hello World')
  });
};
```

2.0 ã§ã¯ã“ã®ã‚ˆã†ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚„é–¢æ•°ãªã©ãŒå¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚
2.0 ä»¥å‰ã§ã¯ rest(ãŠãã‚‰ã REST API ã® REST ãŒç”±æ¥ï¼Ÿ)ãŒ http ã«å¤‰åŒ–ã—ã¦ãŠã‚Šã€
ã¾ãŸæˆ»ã‚Šå€¤ã‚’è¨­å®šã™ã‚‹ã®ã‚‚ã€å¼•æ•°ã§å®šç¾©ã™ã‚‹ã®ã§ã¯ãªãã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸã®ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã«å¤‰åŒ–ã—ã¦ãŠã‚Šã¾ã™ã€‚

# ã©ã†ã—ã¦å¤‰ã‚ã£ãŸã®ã‹

OSS ã§ç ´å£Šçš„å¤‰æ›´ã¯ã‚ã¾ã‚Šå¥½ã¾ã‚Œãªã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ãŒã€MSW ã® OSS ãƒãƒ¼ãƒ ãŒãªãœã“ã†ã„ã†åˆ¤æ–­ã‚’ã—ãŸã®ã‹ã€‚
MSW ã®å…¬å¼ãƒ–ãƒ­ã‚°ã«ãã®çµŒç·¯ã‚„è€ƒãˆãŒè¨˜äº‹ã«ãªã£ã¦ã„ãŸã®ã§ã€ç¢ºèªã—ã¤ã¤è‡ªåˆ†ãŒã©ã†æ‰±ã£ã¦ã„ãŸã‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

ã¨ã„ã†ã“ã¨ã§ã€å…¬å¼ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ã‚’è¦‹ã¦ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
https://mswjs.io/blog/introducing-msw-2.0

## 2.0 ä»¥å‰ã« OSS ãƒãƒ¼ãƒ ãŒæ„Ÿã˜ã¦ã„ãŸå•é¡Œç‚¹

```ts
(req, res, ctx) => res(...)
```

å…¬å¼ã§ã¯ Response Resolve é–¢æ•°ã¨èª­ã‚“ã§ã„ã‚‹é–¢æ•°ã¯ã€éå¸¸ã«ã†ã¾ãå®Ÿè£…ã§ãã¦ãŠã‚Šã€
Response ã®æŠ½è±¡åŒ–ãŒé©åˆ‡ã§ã‚ã‚Šã€ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒã—ã‚„ã™ã„ã¨è©•ä¾¡ã—ã¦ã„ã¾ã™ã€‚
ã—ã‹ã—ã€ãã‚ŒãŒæ•…ã«å…¬å¼ãŒç›®æ¨™ã¨ã—ãŸã“ã¨ã¨ã€ç’°å¢ƒã«é †å¿œã§ãã¦ã„ãªã„ã¨ã„ã†å•é¡ŒãŒç™ºç”Ÿã—ã¦ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

### æ ¹æœ¬çš„ãª Web æŠ€è¡“ã®ç†è§£ã‚’ä¿ƒã›ãªã‹ã£ãŸ

> It failed to educate.
>
> The degree of abstraction in the res() function is far too high to teach you, the developer, anything about actual responses on the web. As a maintainer with >thousands of projects depending on the software I build, I feel itâ€™s my responsibility to care about what developers learn from that software. I want them to >achieve their goals but I also want them to learn concepts and APIs they can apply even outside of MSW because I firmly believe thatâ€™s what a good software does.

å®Ÿè£…ã—ãŸ Response Resolve ç­‰ã® API ãŒé«˜åº¦ã«æŠ½è±¡åŒ–ãŒã•ã‚Œã™ãã€æ•™è‚²ã«å¤±æ•—ã—ã¾ã—ãŸã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚
ãŸã—ã‹ã«ã€MSW ã‚’ä½¿ã£ã¦ Web ã® Response ã‚„ Request å‘¨ã‚Šã®å®Ÿè£…ã‚’èƒ½å‹•çš„ã«å­¦ã³ã«ã„ã£ãŸäº‹ã¯ã»ã¼ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ã¨ã„ã†ã®ã‚‚ã€ç§ã‚‚å€‹äººãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåŠã³æ¥­å‹™ã§ã‚‚ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€MSW ã®åˆ©ç”¨æ–¹æ³•ã‚’èª¿ã¹ãŸã‚Šå®Ÿè£…æ–¹æ³•ã‚’å·¥å¤«ã—ãŸã‚Šã—ã¾ã—ãŸãŒã€
MSW ã‚’é€šã—ã¦ Web ã® Request ã‚„ Response ã‚’æ„Ÿã˜å–ã‚ŒãŸã“ã¨ã¯ãªã‹ã£ãŸãªã¨ã®æŒ¯ã‚Šè¿”ã‚Šã§ã—ãŸã€‚
MSW ãƒãƒ¼ãƒ ã¨ã—ã¦ã¯ã€MSW ã‚’è©³ã—ããªã‚‹ã¨åŒæ™‚ã« Web ã® API ã¨ã‹ã‚’å­¦ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒç†æƒ³ã ã£ãŸã‚ˆã†ã§ã™ã€‚

#### ã©ã†å¤‰ãˆãŸã®ã‹

ã§ã¯ã©ã†å¤‰ãˆãŸã®ã‹ã‚’è¦‹ãªãŒã‚‰ã€MSW ãƒãƒ¼ãƒ 

```ts
import { http } from "msw";

const Handler = () => {
  return http.get("/api/user", async ({ request }) => {
    const user = await request.json();
    return new Response(`Hello World! ${user}`)
  });
};
```

### Node ç’°å¢ƒã§ã®æ›´æ–°ãŒå¤§å¤‰

# MSW 2.0 ã®ãƒ–ãƒ­ã‚°ã¨ OSS ã‹ã‚‰å­¦ã³å–ã‚Œã‚‹äº‹

# ãŠã‚ã‚Šã«
